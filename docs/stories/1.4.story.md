# Story 1.4: Basic TUI Shell with View Management

## Status
Draft

## Story
**As a** user,
**I want** a responsive TUI with keyboard navigation between views,
**so that** I can switch between planning and observability modes.

## Acceptance Criteria
1. TUI launches and displays initial view within 500ms
2. Global keybindings (p, o, q) work from any context
3. View transitions are smooth without flicker
4. Terminal resize events are handled gracefully
5. Help text shows available keybindings

## Tasks / Subtasks
- [ ] Create TUI application structure (AC: 1)
  - [ ] Create internal/tui/app.go with main Bubbletea model
  - [ ] Initialize Bubbletea program with proper options
  - [ ] Set up initial view display and rendering
  - [ ] Implement 500ms launch time validation
- [ ] Implement global keybinding system (AC: 2, 5)
  - [ ] Create internal/tui/keys.go with keybinding definitions
  - [ ] Define global keys: 'p' for plan view, 'o' for observe view, 'q' for quit
  - [ ] Implement HandleKeypress() method for global key processing
  - [ ] Add help overlay component showing available keybindings
- [ ] Create view management system (AC: 3)
  - [ ] Implement SwitchView() method in app.go
  - [ ] Create view interface for consistent view handling
  - [ ] Set up smooth transitions using Bubbletea's update pattern
  - [ ] Ensure no flicker during view switches with proper rendering
- [ ] Create placeholder view implementations (AC: 1, 3)
  - [ ] Create internal/views/plan/view.go with basic plan view
  - [ ] Create internal/views/observe/view.go with basic observe view
  - [ ] Implement Init(), Update(), and View() methods for each
  - [ ] Add placeholder content to verify view switching
- [ ] Implement terminal resize handling (AC: 4)
  - [ ] Add Resize() method to handle terminal size changes
  - [ ] Update view dimensions on WindowSizeMsg events
  - [ ] Test graceful handling of various terminal sizes
  - [ ] Ensure content reflows properly on resize
- [ ] Create shared TUI components (AC: 5)
  - [ ] Create internal/tui/components/help.go for help overlay
  - [ ] Create internal/tui/components/status.go for status bar
  - [ ] Create internal/tui/styles.go with Lipgloss style definitions
  - [ ] Apply consistent styling across all components
- [ ] Add TUI command to CLI (AC: 1)
  - [ ] Create cmd/spcstr/tui.go with Cobra command
  - [ ] Wire TUI command to launch the Bubbletea application
  - [ ] Add proper error handling and graceful shutdown
  - [ ] Update cmd/spcstr/main.go to include TUI command
- [ ] Write unit tests for TUI components (AC: All)
  - [ ] Test model updates without rendering (business logic)
  - [ ] Test keybinding handlers with table-driven tests
  - [ ] Test view switching state management
  - [ ] Create manual test procedures for visual verification
- [ ] Create integration tests (AC: All)
  - [ ] Create test/integration/tui_test.go for TUI interactions
  - [ ] Test launch time performance (<500ms requirement)
  - [ ] Test keyboard navigation flow
  - [ ] Document manual testing procedures

## Dev Notes

### Previous Story Insights
From Story 1.3 completion:
- Resolved circular import issues by separating models into pkg/ directory
- Performance requirements successfully met (10ms for hooks)
- Test coverage below target (42.5%) - ensure better coverage for TUI
- Atomic operations patterns established for file handling
- Fixed Makefile build path to include all cmd/spcstr/*.go files

### TUI Framework Specifications
From [Source: architecture/tech-stack.md#Technology Stack Table]:
- **Bubbletea 0.25.0**: Main TUI framework for event-driven terminal UI
- **Bubbles 0.17.1**: Official UI components library for Bubbletea
- **Lipgloss 0.9.1**: Terminal styling and layout library
- **Glamour 0.6.0**: Markdown rendering in terminal (for help text)

### File Locations
From [Source: architecture/source-tree.md]:
- TUI core: `internal/tui/`
  - `app.go` - Main TUI application and model
  - `keys.go` - Global keybinding definitions
  - `styles.go` - Lipgloss style definitions
- Shared components: `internal/tui/components/`
  - `help.go` - Help overlay component
  - `status.go` - Status bar component
  - `input.go` - Search input component (future use)
- View implementations: `internal/views/`
  - `plan/view.go` - Plan view implementation
  - `observe/view.go` - Observe view implementation
- CLI integration: `cmd/spcstr/tui.go`

### Component Specifications
From [Source: architecture/components.md#TUI Engine Component]:
- **TUI Engine responsibilities**:
  - `Run()` - Start TUI event loop
  - `SwitchView()` - Change active view
  - `HandleKeypress()` - Process global keybindings
  - `Resize()` - Handle terminal resize events
- **Dependencies**: Plan View, Observe View, Event Bus (future)
- **Technology**: Bubbletea 0.25.0, Lipgloss 0.9.1

### View Management Pattern
From [Source: architecture/components.md#Plan View Component and #Observe View Component]:
- Each view implements standard Bubbletea Model interface
- **Plan View interfaces** (future implementation):
  - `IndexDocuments()` - Document indexing
  - `SearchDocuments()` - Search functionality
  - `RenderMarkdown()` - Display markdown content
  - `NavigateDocuments()` - Document navigation
- **Observe View interfaces** (future implementation):
  - `RenderSessionList()` - Display session list
  - `RenderDashboard()` - Show metrics dashboard
  - `HandleSelection()` - Process user selections
  - `UpdateMetrics()` - Refresh metric displays

### Technical Implementation Guidelines
From [Source: architecture/coding-standards.md#Critical Rules and #Go-Specific Guidelines]:
- Use `context.Context` for cancellation in long operations
- Use channels for coordination, mutexes for state protection
- Never panic in library code - return errors properly
- All errors must be wrapped with context using `fmt.Errorf` with `%w`
- Follow established patterns from existing codebase

### Performance Requirements
From [Source: architecture/test-strategy-and-standards.md]:
- TUI launch must complete within 500ms (AC: 1)
- View switches should be instantaneous with no flicker
- Terminal resize should not cause performance degradation
- Consider future integration with Event Bus for real-time updates

### Error Handling Strategy
- TUI operations should never crash the application
- Graceful degradation for terminal compatibility issues
- Clear error messages displayed in TUI when operations fail
- Log errors to `.spcstr/logs/debug.log` for debugging

## Testing

### Testing Standards
From [Source: architecture/test-strategy-and-standards.md#TUI Testing Approach]:
- **Test Framework**: Go standard library testing package
- **File Location**: Same directory as source with `_test.go` suffix
- **Coverage Target**: 60% for UI packages (lower than 80% core requirement)
- **Integration Tests**: `test/integration/tui_test.go`
- **Manual Testing**: Required for visual verification

### TUI Testing Approach
From [Source: architecture/test-strategy-and-standards.md#TUI Testing Approach]:
Since Bubbletea TUIs are challenging to test automatically:
1. Test business logic separately from UI rendering
2. Test model updates without rendering
3. Create manual test scripts for visual verification
4. Consider screenshot-based regression tests for critical views
5. Document manual testing procedures

### Specific Testing Requirements
- Test all keybinding handlers with table-driven tests
- Verify 500ms launch time requirement with benchmarks
- Test view switching state transitions
- Validate terminal resize handling at various sizes
- Create mock views for testing view management
- Manual verification of visual appearance and smooth transitions

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-09-05 | 1.0 | Initial story draft created | Scrum Master |

## Dev Agent Record
*This section will be populated by the development agent during implementation*

### Agent Model Used

### Debug Log References

### Completion Notes List

### File List

## QA Results
*This section will be populated by the QA agent during review*